!function(){"use strict";function t(t,e){var i,r=e.split("."),n=t;for(i=0;i<r.length;++i){if(void 0==n[r[i]])return;n=n[r[i]]}return n}function e(t,e){var i=[];return t?(t.forEach(function(t){~i.indexOf(t[e])||i.push(t[e])}),i.map(function(t){return{text:t,value:t}})):void 0}angular.module("dataGrid",[]).filter("startFrom",function(){return function(t,e){return t?(e=+e,t.slice(e)):[]}}).controller("gridController",["$scope","$element","$filter","$location","filtersFactory",function(i,r,n,a,o){function s(){var t,e=!1;t="page="+i.paginationOptions.currentPage,i.paginationOptions.itemsPerPage!==i.defaultsPaginationOptions.itemsPerPage&&(t+="&itemsPerPage="+i.paginationOptions.itemsPerPage),i.sortOptions.predicate&&(t+="&sort="+encodeURIComponent(i.sortOptions.predicate+"-"+i.sortOptions.direction)),i.filters.forEach(function(r){var n=r.model,a=i[n];if(r.disableUrl)return void(e=!0);if(a){var o;if(a instanceof Date){if(isNaN(a.getTime()))return;o=a.getFullYear()+"-",o+=a.getMonth()<9?"0"+(a.getMonth()+1)+"-":a.getMonth()+1+"-",o+=a.getDate()<10?"0"+a.getDate():a.getDate(),a=o}t+="&"+encodeURIComponent(n)+"="+encodeURIComponent(a)}}),e&&p(),a.path(t)}function c(){var t=a.path().slice(1),e={},r={};if(i.params=e,t.split("&").forEach(function(t){var i=t.split("=");e[i[0]]=i[1],"page"!==i[0]&&"sort"!==i[0]&&"itemsPerPage"!==i[0]&&(r[decodeURIComponent(i[0])]=decodeURIComponent(i[1]))}),i.filters.forEach(function(t){var e=t.model,n=r[e],a=i;if(!t.disableUrl){if(~t.filterType.toLowerCase().indexOf("date")&&n)return void(a[e]=new Date(n));"select"!==t.filterType||n||(n=""),a[e]=n}}),i.serverPagination||g(),i.paginationOptions.itemsPerPage=i.defaultsPaginationOptions.itemsPerPage,i.paginationOptions.currentPage=i.defaultsPaginationOptions.currentPage,e.itemsPerPage&&(i.paginationOptions.itemsPerPage=e.itemsPerPage),e.page&&(!i.serverPagination&&(e.page-1)*i.paginationOptions.itemsPerPage>i.filtered.length?i.paginationOptions.currentPage=1:i.paginationOptions.currentPage=e.page),e.sort){var n=e.sort.split("-");i.sortOptions.predicate=decodeURIComponent(n[0]),i.sortOptions.direction=decodeURIComponent(n[1])}i.serverPagination||p()}function l(){var t=a.path().slice(1);i._gridOptions.getData("?"+t,function(t,e){i.filtered=t,i.paginationOptions.totalItems=e})}function p(){var t=Date.now(),e=!1;i._time={},i.sortOptions.predicate&&i.sortCache&&i.sortCache.predicate===i.sortOptions.predicate&&i.sortCache.direction===i.sortOptions.direction?(i.filtered=i.sortCache.data.slice(),e=!0):i.filtered=i._gridOptions.data.slice(),i._time.copy=Date.now()-t;var r=Date.now();g(),i._time.filters=Date.now()-r;var a=Date.now();i.sortOptions.predicate&&!e&&(i.filtered=n("orderBy")(i.filtered,i.sortOptions.predicate,"desc"===i.sortOptions.direction),i.sortCache={data:i.filtered.slice(),predicate:i.sortOptions.predicate,direction:i.sortOptions.direction}),i._time.sort=Date.now()-a,i._time.all=Date.now()-t,i.paginationOptions.totalItems=i.filtered.length}function g(){i.filters.forEach(function(t){var e=t.filterBy,r=t.model,n=i[r],a=t.filterType;if(i.customFilters[r])i.filtered=i.customFilters[r](i.filtered,n,e);else if(n&&a){var s=o.getFilterByType(a);s&&(i.filtered=s(i.filtered,n,e))}})}i._gridOptions=t(i,r.attr("grid-options")),i._gridActions=t(i,r.attr("grid-actions")),i.serverPagination="true"===r.attr("server-pagination"),i.getDataDelay=r.attr("get-delay")||350,i._gridActions||(i.$parent[r.attr("grid-actions")]={},i._gridActions=i.$parent[r.attr("grid-actions")]),i.filtered=angular.copy(i._gridOptions.data),i.paginationOptions=i._gridOptions.pagination?angular.copy(i._gridOptions.pagination):{},i.defaultsPaginationOptions={itemsPerPage:i.paginationOptions.itemsPerPage||"10",currentPage:i.paginationOptions.currentPage||1},i.paginationOptions=angular.copy(i.defaultsPaginationOptions),i.sortOptions=i._gridOptions.sort?angular.copy(i._gridOptions.sort):{},i.customFilters=i._gridOptions.customFilters?angular.copy(i._gridOptions.customFilters):{},i.urlSync=i._gridOptions.urlSync,i.$watch("_gridOptions.data",function(t){t&&t.length&&(i.sortCache={},i.filtered=i._gridOptions.data.slice(),i.filters.forEach(function(t){"select"===t.filterType&&(i[t.model+"Options"]=e(i.filtered,t.filterBy))}),i.urlSync?c(a.path()):p())}),i.sort=function(t){var e=i.sortOptions.predicate===t&&"desc"===i.sortOptions.direction?"asc":"desc";i.sortOptions.predicate=t,i.sortOptions.direction=e,i.paginationOptions.currentPage=1,i.reloadGrid()},i.filter=function(){i.paginationOptions.currentPage=1,i.reloadGrid()},i.$on("$locationChangeSuccess",function(){(i.urlSync||i.serverPagination)&&(i.serverPagination&&(clearTimeout(i.getDataTimeout),i.getDataTimeout=setTimeout(l,i.getDataDelay)),i.filtered&&c(a.path()))}),i.reloadGrid=function(){i.urlSync||i.serverPagination?s():p()},i._gridActions.refresh=i.reloadGrid,i._gridActions.filter=i.filter,i._gridActions.sort=i.sort}]).directive("gridData",["$compile","$animate",function(i,r){return{restrict:"EA",transclude:!0,replace:!0,controller:"gridController",link:function(n,a,o,s,c){var l=[],p=[],g=[],d=n.$new(),u=a.parent(),f=o.id,m="true"===o.serverPagination;c(n,function(t){r.enter(t,a)}),angular.forEach(angular.element(u[0].querySelectorAll("[sortable]")),function(t){var e=angular.element(t),r=e.attr("sortable");l.push(e),e.attr("ng-class","{'sort-ascent' : sortOptions.predicate ==='"+r+"' && sortOptions.direction === 'asc', 'sort-descent' : sortOptions.predicate === '"+r+"' && sortOptions.direction === 'desc'}"),e.attr("ng-click","sort('"+r+"')"),i(e)(d)}),angular.forEach(angular.element(document.querySelectorAll("[filter-by]")),function(r){var o=angular.element(r),s=u.find(o).length>0,c=o.attr("filter-by"),l=o.attr("filter-type")||"",g=o.attr("ng-model"),d=o.attr("disable-url");f&&o.attr("grid-id")&&f!=o.attr("grid-id")||("select"!==l||(n[g+"Options"]=e(t(n,a.attr("grid-options")+".data"),c)),!~l.indexOf("date")||o.attr("ng-focus")||o.attr("ng-blur")||(o.attr("ng-focus","filter('{"+g+" : this."+g+"}')"),o.attr("ng-blur","filter('{"+g+" : this."+g+"}')"),i(o)(n)),g||(g=c,o.attr("ng-model",c),o.attr("ng-change","filter()"),i(o)(n)),p.push({model:g,isInScope:s,filterBy:c,filterType:l,disableUrl:d}))}),angular.forEach(angular.element(u[0].querySelectorAll("[grid-item]")),function(t){var e=angular.element(t);g.push(e),m?e.attr("ng-repeat","item in filtered"):e.attr("ng-repeat","item in filtered | startFrom:(paginationOptions.currentPage-1)*paginationOptions.itemsPerPage | limitTo:paginationOptions.itemsPerPage track by $index"),i(e)(d)}),n.sorting=l,n.rows=g,n.filters=p}}}]).factory("filtersFactory",function(){function t(t,e,i){return t.filter(function(t){return e&&t[i]?t[i]===e:!0})}function e(t,e,i){return t.filter(function(t){return e&&t[i]?~(t[i]+"").toLowerCase().indexOf(e.toLowerCase()):!0})}function i(t,e,i){return e=new Date(e).getTime(),t.filter(function(t){return e&&t[i]?t[i]<=e+86399999:!0})}function r(t,e,i){return e=new Date(e).getTime(),t.filter(function(t){return e&&t[i]?t[i]>=e:!0})}return{getFilterByType:function(n){switch(n){case"select":return t;case"text":return e;case"dateTo":return i;case"dateFrom":return r;default:return null}}}})}();