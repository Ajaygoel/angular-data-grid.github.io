function deepFind(t,e){var i,r=e.split("."),n=t;for(i=0;i<r.length;++i){if(void 0==n[r[i]])return;n=n[r[i]]}return n}angular.module("dataGrid",[]).filter("startFrom",function(){return function(t,e){return t?(e=+e,t.slice(e)):[]}}).controller("gridController",["$scope","$element","$filter","$location","filtersFactory",function(t,e,i,r,n){function a(){var e,i=!1;e="page="+t.paginationOptions.currentPage,t.paginationOptions.itemsPerPage!==t.defaultsPaginationOptions.itemsPerPage&&(e+="&itemsPerPage="+t.paginationOptions.itemsPerPage),t.sortOptions.predicate&&(e+="&sort="+encodeURIComponent(t.sortOptions.predicate+"-"+t.sortOptions.direction)),t.filters.forEach(function(r){var n=r.model,a=t[n];if(r.disableUrl)return void(i=!0);if(a){var o;if(a instanceof Date){if(isNaN(a.getTime()))return;o=a.getFullYear()+"-",o+=a.getMonth()<9?"0"+(a.getMonth()+1)+"-":a.getMonth()+1+"-",o+=a.getDate()<10?"0"+a.getDate():a.getDate(),a=o}e+="&"+encodeURIComponent(n)+"="+encodeURIComponent(a)}}),i&&l(),r.path(e)}function o(){var e=r.path().slice(1),i={},n={};if(t.params=i,e.split("&").forEach(function(t){var e=t.split("=");i[e[0]]=e[1],"page"!==e[0]&&"sort"!==e[0]&&"itemsPerPage"!==e[0]&&(n[decodeURIComponent(e[0])]=decodeURIComponent(e[1]))}),t.filters.forEach(function(e){var i=e.model,r=n[i],a=t;if(!e.disableUrl){if(~e.filterType.toLowerCase().indexOf("date")&&r)return void(a[i]=new Date(r));"select"!==e.filterType||r||(r=""),a[i]=r}}),t.serverPagination||g(),t.paginationOptions.itemsPerPage=t.defaultsPaginationOptions.itemsPerPage,t.paginationOptions.currentPage=t.defaultsPaginationOptions.currentPage,i.itemsPerPage&&(t.paginationOptions.itemsPerPage=i.itemsPerPage),i.page&&(!t.serverPagination&&(i.page-1)*t.paginationOptions.itemsPerPage>t.filtered.length?t.paginationOptions.currentPage=1:t.paginationOptions.currentPage=i.page),i.sort){var a=i.sort.split("-");t.sortOptions.predicate=decodeURIComponent(a[0]),t.sortOptions.direction=decodeURIComponent(a[1])}t.serverPagination||l()}function s(){var e=r.path().slice(1);t._gridOptions.getData("?"+e,function(e,i){t.filtered=e,t.paginationOptions.totalItems=i})}function l(){t.filtered=angular.copy(t._gridOptions.data),g(),t.filtered=i("orderBy")(t.filtered,t.sortOptions.predicate,"desc"===t.sortOptions.direction),t.paginationOptions.totalItems=t.filtered.length}function g(){t.filters.forEach(function(e){var i=e.filterBy,r=e.model,a=t[r],o=e.filterType;if(t.customFilters[r])t.filtered=t.customFilters[r](t.filtered,a,i);else if(a&&o){var s=n.getFilterByType(o);s&&(t.filtered=s(t.filtered,a,i))}})}t._gridOptions=deepFind(t,e.attr("grid-options")),t._gridActions=deepFind(t,e.attr("grid-actions")),t.serverPagination="true"===e.attr("server-pagination"),t.getDataDelay=e.attr("get-delay")||350,t._gridActions||(t.$parent[e.attr("grid-actions")]={},t._gridActions=t.$parent[e.attr("grid-actions")]),t.filtered=angular.copy(t._gridOptions.data),t.paginationOptions=t._gridOptions.pagination?angular.copy(t._gridOptions.pagination):{},t.defaultsPaginationOptions={itemsPerPage:t.paginationOptions.itemsPerPage||10,currentPage:t.paginationOptions.currentPage||1},t.paginationOptions=angular.copy(t.defaultsPaginationOptions),t.sortOptions=t._gridOptions.sort?angular.copy(t._gridOptions.sort):{},t.customFilters=t._gridOptions.customFilters?angular.copy(t._gridOptions.customFilters):{},t.urlSync=t._gridOptions.urlSync,t.$watch("_gridOptions.data",function(e){e&&e.length&&(t.filtered=angular.copy(t._gridOptions.data),t.urlSync?o(r.path()):l())}),t.sort=function(e){var i=t.sortOptions.predicate===e&&"desc"===t.sortOptions.direction?"asc":"desc";t.sortOptions.predicate=e,t.sortOptions.direction=i,t.paginationOptions.currentPage=1,t.reloadGrid()},t.filter=function(){t.paginationOptions.currentPage=1,t.reloadGrid()},t.$on("$locationChangeSuccess",function(){(t.urlSync||t.serverPagination)&&(t.serverPagination&&(clearTimeout(t.getDataTimeout),t.getDataTimeout=setTimeout(s,t.getDataDelay)),t.filtered&&o(r.path()))}),t.reloadGrid=function(){t.urlSync||t.serverPagination?a():l()},t._gridActions.refresh=t.reloadGrid,t._gridActions.filter=t.filter,t._gridActions.sort=t.sort}]).directive("gridData",["$compile","$animate",function(t,e){return{restrict:"EA",transclude:!0,replace:!0,controller:"gridController",link:function(i,r,n,a,o){function s(t,e){var i=[];return t?(t.forEach(function(t){~i.indexOf(t[e])||i.push(t[e])}),i.map(function(t){return{text:t,value:t}})):void 0}var l=[],g=[],c=[],p=i.$new(),d=r.parent(),u=n.id,f="true"===n.serverPagination;o(i,function(t){e.enter(t,r)}),angular.forEach(angular.element(d[0].querySelectorAll("[sortable]")),function(e){var i=angular.element(e),r=i.attr("sortable");l.push(i),i.attr("ng-class","{'sort-ascent' : sortOptions.predicate ==='"+r+"' && sortOptions.direction === 'asc', 'sort-descent' : sortOptions.predicate === '"+r+"' && sortOptions.direction === 'desc'}"),i.attr("ng-click","sort('"+r+"')"),t(i)(p)}),angular.forEach(angular.element(document.querySelectorAll("[filter-by]")),function(e){var n=angular.element(e),a=d.find(n).length>0,o=n.attr("filter-by"),l=n.attr("filter-type")||"",c=n.attr("ng-model"),p=n.attr("disable-url");if(!u||!n.attr("grid-id")||u==n.attr("grid-id")){if("select"===l){var f=s(deepFind(i,r.attr("grid-options")+".data"),o);i[c+"Options"]=f}!~l.indexOf("date")||n.attr("ng-focus")||n.attr("ng-blur")||(n.attr("ng-focus","filter('{"+c+" : this."+c+"}')"),n.attr("ng-blur","filter('{"+c+" : this."+c+"}')"),t(n)(i)),c||(c=o,n.attr("ng-model",o),n.attr("ng-change","filter()"),t(n)(i)),g.push({model:c,isInScope:a,filterBy:o,filterType:l,disableUrl:p})}}),angular.forEach(angular.element(d[0].querySelectorAll("[grid-item]")),function(e){var i=angular.element(e);c.push(i),f?i.attr("ng-repeat","item in filtered"):i.attr("ng-repeat","item in filtered | startFrom:(paginationOptions.currentPage-1)*paginationOptions.itemsPerPage | limitTo:paginationOptions.itemsPerPage"),t(i)(p)}),i.sorting=l,i.rows=c,i.filters=g}}}]).directive("gridItemPerPage",["$compile",function(t){return{replace:!0,template:'<ul class="pagination"></ul>',link:function(e,i,r){if(r.gridItemPerPage){var n=r.gridItemPerPage.replace(/ /g,"").split(",");n.forEach(function(r){if(Number(r)){r=Number(r);var n=angular.element("<li></li>"),a=angular.element("<a href>"+r+"</a>");a.attr("ng-click","paginationOptions.itemsPerPage = "+r+"; reloadGrid()"),n.attr("ng-class",'{"active" : paginationOptions.itemsPerPage == '+r+"}"),n.append(a),i.append(n),i.append(" "),t(n)(e)}})}}}}]).factory("filtersFactory",function(){function t(t,e,i){return t.filter(function(t){return e&&t[i]?t[i]===e:!0})}function e(t,e,i){return t.filter(function(t){return e&&t[i]?~t[i].toLowerCase().indexOf(e.toLowerCase()):!0})}function i(t,e,i){return e=new Date(e).getTime(),t.filter(function(t){return e&&t[i]?t[i]<=e+86399999:!0})}function r(t,e,i){return e=new Date(e).getTime(),t.filter(function(t){return e&&t[i]?t[i]>=e:!0})}return{getFilterByType:function(n){switch(n){case"select":return t;case"text":return e;case"dateTo":return i;case"dateFrom":return r;default:return null}}}});